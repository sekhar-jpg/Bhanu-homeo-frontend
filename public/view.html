<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Submitted Cases</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input[type="text"] {
      margin-bottom: 10px;
      padding: 5px;
      width: 300px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    button {
      margin-right: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Submitted Cases</h2>
  <input type="text" id="searchInput" placeholder="Search by name or phone..." />

  <table>
    <thead>
      <tr>
        <th>Visit Date</th>
        <th>Name</th>
        <th>Phone</th>
        <th>Follow-Up Date</th>
        <th>Chief Complaints</th>
        <th>Mental Symptoms</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="caseTableBody"></tbody>
  </table>

  <script>
    const apiUrl = 'https://backend-bhanu-app.onrender.com/api/cases';

    function formatDate(dateStr) {
      if (!dateStr) return '‚Äî';
      const date = new Date(dateStr);
      return date.toISOString().split('T')[0];
    }

    async function fetchCases() {
      const res = await fetch(apiUrl);
      const data = await res.json();
      displayCases(data);
    }

    function displayCases(cases) {
      const tbody = document.getElementById('caseTableBody');
      tbody.innerHTML = '';

      cases.forEach(c => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${formatDate(c.visitDate)}</td>
          <td>${c.patientName || '‚Äî'}</td>
          <td>${c.phoneNumber || '‚Äî'}</td>
          <td>${formatDate(c.followUpDate)}</td>
          <td>${c.symptoms || '‚Äî'}</td>
          <td>${c.mentalSymptoms || '‚Äî'}</td>
          <td>
            <button class="edit-btn" data-id="${c._id}">‚úèÔ∏è</button>
            <button class="delete-btn" data-id="${c._id}">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Attach event listeners
      document.querySelectorAll('.delete-btn').forEach(btn =>
        btn.addEventListener('click', async (e) => {
          const id = e.target.dataset.id;
          if (confirm('Are you sure you want to delete this case?')) {
            await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
            fetchCases();
          }
        })
      );

      document.querySelectorAll('.edit-btn').forEach(btn =>
        btn.addEventListener('click', async (e) => {
          const id = e.target.dataset.id;
          const name = prompt("Enter updated name:");
          const phone = prompt("Enter updated phone:");
          const symptoms = prompt("Enter updated symptoms:");
          const mental = prompt("Enter updated mental symptoms:");
          const followUp = prompt("Enter updated follow-up date (YYYY-MM-DD):");

          const updatedData = {
            patientName: name,
            phoneNumber: phone,
            symptoms,
            mentalSymptoms: mental,
            followUpDate: followUp
          };

          await fetch(`${apiUrl}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedData)
          });
          fetchCases();
        })
      );
    }

    // Search functionality
    document.getElementById('searchInput').addEventListener('input', function () {
      const term = this.value.toLowerCase();
      const rows = document.querySelectorAll('#caseTableBody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? '' : 'none';
      });
    });

    // Initial fetch
    fetchCases();
  </script>
</body>
</html>
